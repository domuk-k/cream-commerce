### 기능 요구사항

1. 포인트

   - 사용자는 포인트를 충전할 수 있다.
   - 사용자는 포인트를 조회할 수 있다.

2. 상품

   - 사용자는 상품 정보를 조회할 수 있다.
     - 상품 정보는 ID, 이름, 가격, 재고 수량을 포함한다.

3. 쿠폰 

   - 사용자는 쿠폰을 발급 받을 수 있다.
     - **지정된 갯수**의 쿠폰에 대해, 발급요청한 유저에게 **하나씩** 발급한다.
   - 사용자는 쿠폰을 조회할 수 있다.
     - 발급받은 쿠폰 목록을 조회할 수 있다.
     - 쿠폰 정보는 유효 여부, 사용 여부, 할인 정책을 포함한다.
   - 사용자는 쿠폰을 상품 주문 시 쿠폰 적용할 수 있다.
     - 유효성에 따라 적용 실패할 수 있다.

4. 주문

   - 사용자는 다중 상품 주문 할 수 있다.
   - 재고/잔액/쿠폰 검증이 성공하면 주문을 받는다.

5. 결제
   - 사용자는 다중 상품 결제 할 수 있다.
   - 재고 감소 + 포인트 차감 + 쿠폰 소모 + 주문내역 저장
   - 외부 플랫폼으로 주문 정보 전송 (Mock 처리)

6. 인기 상품 조회
   - 사용자는 인기 상품 목록을 조회할 수 있다.
   - 최근 N일간 판매량 기준 인기 상품 Top N 조회
   - 주문 시점 기반 통계 계산 (비동기 or 배치)

---

### 도메인별 비기능 요구사항

#### 공통 비기능 요구사항

1. **동시성 제어**

   - 공유 자원 접근 시 일관성 보장
   - 멀티 인스턴스 환경에서도 정합성 유지

2. **트랜잭션 일관성**

   - 복합 작업(여러 도메인 간 상호작용)의 원자성 보장
   - 오류 발생 시 안전한 롤백 지원

3. **확장성**

   - 락/큐 추상화 구조를 통한 Redis 등 외부 시스템 연동 가능
   - 서버 간 상태 공유가 없는 stateless 아키텍처

4. **테스트 가능성**

   - 도메인별 단위 테스트 지원
   - 통합 테스트 환경 구성

5. **문서화**
   - Swagger 기반 API 문서 자동화
   - 코드 가독성 유지 및 주석 처리

#### 1. 포인트 도메인

- **동시성 처리**

  - 동일 사용자의 포인트 충전/사용 시 경쟁 상태(race condition) 방지

- **데이터 정합성**

  - 포인트 증감 이력 추적 가능
  - 오류 발생 시에도 포인트 잔액 무결성 보장

- **성능**
  - 대량 충전 요청 처리 능력

#### 2. 상품 도메인

- **재고 관리 동시성**

  - 재고 감소 시 경쟁 상태 방지
  - 상품 ID 기반 락 구현

- **읽기 성능 최적화**

  - 상품 조회 API 캐싱 전략 적용
  - 다수 상품 조회 시 페이지네이션 지원

- **재고 정합성**
  - 품절 상태에서 주문 불가 보장
  - 재고 변경 이력 추적 가능

#### 3. 쿠폰 도메인

- **선착순 발급 처리**

  - 지정된 수량 초과 발급 방지
  - 대량 요청 시 성능 저하 최소화

- **중복 사용 방지**

  - 쿠폰 사용 시 낙관적/비관적 락 적용
  - 이미 사용된 쿠폰 재사용 불가 보장

- **유효성 검증 성능**
  - 주문 시 쿠폰 적용 가능 여부 빠른 검증
  - 복잡한 할인 정책 적용 시에도 응답 지연 최소화

#### 4. 주문 도메인

- **상태 관리 일관성**

  - 주문 상태 변경의 원자성 보장
  - 동시 상태 변경 요청 처리 메커니즘

- **확장성**

  - 다양한 주문 유형 지원 가능한 설계
  - 주문 항목 확장 가능

- **조회 성능**
  - 주문 내역 빠른 조회 지원
  - 복잡한 조건 검색 최적화

#### 5. 결제 도메인

- **트랜잭션 무결성**

  - 포인트 차감의 원자성 보장
  - 쿠폰 적용의 정확성 보장

- **보안**

  - 결제 정보 암호화 저장
  - 접근 권한 제한

- **외부 시스템 연동**
  - 외부 결제 시스템 장애 대응
  - 결제 실패 시 롤백 메커니즘

#### 6. 인기 상품 통계 도메인

- **비동기 처리**

  - 통계 계산이 주문 처리 성능에 영향 미치지 않도록 분리
  - 백그라운드 처리 또는 배치 작업으로 구현

- **데이터 일관성**

  - 통계 데이터 최신성 보장 (지정된 갱신 주기)
  - 계산 오류 발생 시 복구 메커니즘

- **조회 성능**
  - 인기 상품 목록 빠른 응답 지원
  - 캐싱 전략 적용

---

### 구현 시 고려할 도메인별 주요 포인트

#### 포인트 도메인

- 사용자별 락 구현으로 동시 포인트 변경 제어
- 포인트 이력 추적 위한 설계

#### 상품 도메인

- 재고 변경 시 락 메커니즘 적용
- 읽기 성능 최적화를 위한 캐싱 전략

#### 쿠폰 도메인

- 선착순 발급의 정확성과 성능 균형
- 쿠폰 상태 변경 시 동시성 제어

#### 주문/결제 도메인

- 복합 리소스 변경의 원자성 보장
- 외부 시스템 통신 실패 시 복구 전략

#### 인기 상품 통계 도메인

- 주문 처리와 분리된 비동기 통계 처리
- 효율적인 집계 알고리즘 구현
